<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Bonus</title>
<link rel="stylesheet" href="assets/css/dailybonus.css">
</head>
<body>
<a href="home.html" class="back-btn">&#8592; Back</a>

<div class="bonus-container">
    <h1>Daily Bonus!</h1>
    <p id="bonus-message">Claim your reward!</p>
    <button id="claim-button">Claim Bonus</button>
    <p id="countdown"></p>
    <p>Your total balance: <span id="main-balance">0</span> coins</p>
</div>

<div class="overlay"></div>
<div class="message" id="winMessage">
    <h2>ðŸŽ‰ Congratulations!</h2>
    <p id="reward-text"></p>
    <div class="action-buttons">
        <button id="addBalanceBtn">Add to Main Balance</button>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAkWyk3q-zaDHkjDs90Bm2ih_qw-O_ZJQU",
    authDomain: "coin-to-real-cash.firebaseapp.com",
    databaseURL: "https://coin-to-real-cash-default-rtdb.firebaseio.com",
    projectId: "coin-to-real-cash",
    storageBucket: "coin-to-real-cash.firebasestorage.app",
    messagingSenderId: "265929655267",
    appId: "1:265929655267:web:7eb846fe7bd104761a56d6"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

const claimButton = document.getElementById('claim-button');
const bonusMessage = document.getElementById('bonus-message');
const countdownElement = document.getElementById('countdown');
const mainBalanceElement = document.getElementById('main-balance');
const overlay = document.querySelector('.overlay');
const winMessage = document.getElementById('winMessage');
const rewardText = document.getElementById('reward-text');
const addBalanceBtn = document.getElementById('addBalanceBtn');

const dailyInterval = 24 * 60 * 60 * 1000; 
const dailyReward = 50; 

let currentUserRef;
let mainBalance = 0;

auth.onAuthStateChanged(user => {
    if(!user){ window.location.href = "login.html"; return; }
    currentUserRef = db.ref("users/" + user.uid);

    // Fetch and display balance
    currentUserRef.on("value", snapshot => {
        const data = snapshot.val();
        mainBalance = (data && data.coins) || 0;
        mainBalanceElement.textContent = mainBalance;
    });

    updateUI();
});

function updateUI() {
    currentUserRef.get().then(snapshot => {
        const data = snapshot.val();
        const lastClaimTime = (data && data.lastClaimTime) || 0;
        const now = new Date().getTime();

        if (now - lastClaimTime < dailyInterval) {
            claimButton.disabled = true;
            const timeRemaining = dailyInterval - (now - lastClaimTime);
            startCountdown(timeRemaining);
            bonusMessage.textContent = "You've already claimed your bonus today!";
        } else {
            claimButton.disabled = false;
            bonusMessage.textContent = "Claim your reward!";
            countdownElement.textContent = "";
        }
    });
}

function startCountdown(time) {
    let remaining = time;
    const interval = setInterval(() => {
        remaining -= 1000;
        if (remaining <= 0) { clearInterval(interval); updateUI(); } 
        else {
            const hours = Math.floor(remaining / (1000 * 60 * 60));
            const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
            countdownElement.textContent = `Next bonus in: ${hours}h ${minutes}m ${seconds}s`;
        }
    }, 1000);
}

claimButton.addEventListener('click', () => {
    claimButton.disabled = true;
    const now = new Date().getTime();
    
    rewardText.textContent = `You have got ${dailyReward} coins!`;
    overlay.style.display = 'block';
    winMessage.style.display = 'block';
    currentUserRef.update({lastClaimTime: now});
});

addBalanceBtn.addEventListener('click', () => {
    overlay.style.display = 'none';
    winMessage.style.display = 'none';

    currentUserRef.get().then(snapshot => {
        const data = snapshot.val();
        const coins = (data && data.coins) || 0;
        const todaysEarnings = (data && data.todaysEarnings) || 0;

        currentUserRef.update({
            coins: coins + dailyReward,
            todaysEarnings: todaysEarnings + dailyReward
        }).then(() => {
            claimButton.disabled = true;
            updateUI();
        });
    });
});
</script>
 
</body>
</html>
